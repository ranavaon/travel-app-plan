# תכנון אפליקציית טיולים – מסמך מלא

## 0. מטרה ועקרונות (מתוך גרסה מעודכנת)

### מטרה
אפליקציית Web קטנה וממוקדת לתכנון טיולים: תכנון לפי ימים, פעילויות ורשימות, מותאמת לשימוש **בשטח** (כולל תמיכה חלקית ב־offline).

האפליקציה **אינה** פלטפורמת הזמנות או מנוע המלצות. הערך שלה: **בהירות, פשטות ושימושיות במהלך הטיול עצמו**.

### משתמשי יעד (פרסונות)
- משפחות או זוגות שמתכננים טיול רב־יומי
- טיילים עירוניים (טיולי עיר, מסלולים בסגנון אירופה)
- משתמשים שרוצים **מקור אמת אחד** לתכנית הטיול

הנחות: מתכנן ראשי אחד לטיול; צורך מזדמן לשתף את התכנית; שימוש **mobile-first** במהלך הטיול.

### עקרונות מנחים
- **פשטות > חכמות**
- **מהירות > שפע פיצ'רים**
- **שימושית במהלך הטיול**, לא רק לפניו

---

## 1. הגדרת MVP (Minimum Viable Product)

### מטרה טכנית
אפליקציה אחת שפועלת ב־**Web** וב־**מובייל** (PWA / Add to Home Screen), שמאפשרת לתכנן טיול יום־יום ולעקוב אחר לינה, אטרקציות ורשימות.

---

### 1.1 משתמש ורישום
- **הרשמה/התחברות** – אימייל + סיסמה (או כניסה עם Google/Apple לשלב מתקדם).
- **פרופיל בסיסי** – שם, אימייל (ללא חובה בשלב MVP).

---

### 1.2 טיול
- **יצירת טיול**: שם, תאריך התחלה, תאריך סיום, יעד (אופציונלי).
- **עריכת טיול**: שינוי שם, תאריכים.
- **מחיקת טיול** (עם אישור).
- **רשימת טיולים**: הצגת כל הטיולים של המשתמש (עתיד/עבר – סינון אופציונלי).

---

### 1.3 ימים ופעילויות (מודל מאוחד)
- **ימים אוטומטיים** – לפי טווח התאריכים של הטיול (יום 1, יום 2...).
- **לכל יום – פעילויות** (ישות אחת עם סוג):
  - **סוג פעילות**: אטרקציה | לינה | תחבורה | הערה כללית.
  - **שדות**: כותרת, תיאור/הערות, קישור (אופציונלי, למשל לאתר/הזמנה), מיקום (lat/lng + לינק למפה חיצונית), שעת התחלה ומשך (אופציונלי).
  - **סדר פעילויות** – גרירה לשינוי סדר.
  - **הוספה/עריכה/מחיקה** של פעילות.
- **מבט "יום"** – מסך אחד שמציג את כל המידע של היום: כל הפעילויות (כולל לינה ואטרקציות של אותו יום).

---

### 1.4 לינה ואטרקציות (כפעילויות)
- **לינה** – מודל כפעילות מסוג "לינה" ביום הרלוונטי; שדות: שם, כתובת, תאריכי כניסה/יציאה (אופציונלי), הערות, לינק להזמנה. במבט יום: הצגת "איפה ישנים" לפי תאריכים.
- **אטרקציות** – פעילות מסוג "אטרקציה" משויכת ליום אחד; שדות כמו פעילות + שעות פתיחה/מחיר אופציונלי. הצגה ברשימה כללית ובמבט היום.

*(אלטרנטיבה ששקלנו: ישויות נפרדות Accommodation ו־Attraction – מסמך קודם; המודל המאוחד מפשט את ה־MVP.)*

---

### 1.5 רשימות לטיול
- **רשימה לטיול**: רשימת ציוד (Packing) + רשימת משימות (TODO).
- **פריט**: טקסט, סימון "בוצע" (checkbox).
- הוספה, עריכה, מחיקה, שינוי סדר.
- אופציונלי ב־MVP: קטגוריות (ציוד / מסמכים / מכולת).

---

### 1.6 תמיכה ב־Offline (מפורשת ב־MVP)
האפליקציה בנויה כ־PWA עם **התנהגות offline מכובדת**.

**נתמך offline:**
- צפייה בטיולים, ימים ופעילויות קיימים
- צפייה ברשימות ופעילויות
- עריכת תוכן קיים (תור לסנכרון)

**לא נתמך offline:**
- התחברות / אימות
- יצירת טיול חדש
- שיתוף

**סנכרון:** שינויים שנעשו offline מסתנכרנים אוטומטית עם החזרת החיבור.

---

### 1.7 שיתוף (MVP+)
- **קישור read-only** – יצירת קישור לשיתוף תצוגת הטיול (לקריאה בלבד).
- עתיד: הזמנה באימייל, הרשאות עריכה.

---

### 1.8 ייצוא
- **ייצוא להדפסה / PDF** – תצוגת טיול להדפסה.
- **ייצוא טקסט** – טקסט פשוט לשיתוף.

---

### 1.9 מפות (MVP מינימלי)
- **מיקום בפעילות** – שדה אופציונלי (lat/lng + לינק למפה חיצונית).
- **פתיחת ניווט חיצוני** – כפתור "נווט" שפותח Waze/Google Maps עם הכתובת.
- אופציונלי: הצגת נקודות על מפה במבט יום (או רק לינקים למפות חיצוניות – "לא מפות/ניווט מתקדם" ב־Out of Scope).

---

### דרישות לא-פונקציונליות (NFR)
- **ביצועים:** טעינת האפליקציה תוך פחות מ־2 שניות במובייל.
- **אמינות:** אובדן מידע במצב offline – לא מקובל.
- **אבטחה:** נתוני משתמש פרטיים כברירת מחדל.
- **סקאלביליות:** מותאם לשימוש אישי/משפחתי קטן–בינוני (לא מסת scale תיירותי).

---

### 1.10 צילומי מסמכים (שלב 2)
משתמש יכול לשמור באפליקציה צילומים של מסמכים חשובים לטיול (דרכון, ויזה, ביטוח, הזמנות וכו').

- **שיוך לטיול** – כל מסמך משויך לטיול מסוים (או "כללי" למשתמש – אופציונלי).
- **הוספת מסמך**:
  - צילום במצלמה (במובייל) או העלאת קובץ תמונה (Web/מובייל).
  - כותרת/תיאור (למשל "דרכון", "ויזה", "ביטוח נסיעות").
  - סוג מסמך (אופציונלי): רשימה קבועה או טקסט חופשי.
- **תצוגה** – גלריה/רשימה של המסמכים של הטיול; לחיצה להגדלה/צפייה.
- **עריכה ומחיקה** – שינוי כותרת, מחיקת מסמך (עם אישור).
- **פרטיות ואבטחה** – המסמכים שייכים למשתמש; מומלץ לאחסן מוצפן או עם הרשאות ברורות ב־Backend. ב־MVP/שלב 2 אפשר אחסון פשוט (למשל קבצים בענן של המשתמש או ב־DB כ־blob/base64 עם הגבלת גישה).

---

### מה במפורש מחוץ ל־Scope (Out of Scope)
- הזמנת מלונות / טיסות
- השוואת מחירים
- מנוע המלצות
- מפות או ניווט מתקדם (רק לינק למפות חיצוניות)
- פיצ'רים חברתיים

### שלב 2 ומעבר (לא MVP)
- שיתוף עם הרשאות עריכה והזמנה באימייל
- תקציב ומעקב הוצאות
- תזכורות (push)
- PWA "התקנה למסך" + offline (כחלק מ־MVP בגרסה המעודכנת – ראה למעלה)
- צילומי מסמכים (דרכון, ויזה וכו')

### פיצ'רים מתוכננים (שלב 2 / רשימת משאלות)

- **חיפוש תחנות תחבורה ציבורית (מטרו/אוטובוס) קרובות**  
  - חיפוש תחנות מטרו או אוטובוס **קרובות למיקום הנוכחי** של המשתמש, או **למיקום אטרקציה/פעילות** שנבחרה.  
  - מטרה: להקל הגעה לאטרקציה או החלטה איך לצאת מהמקום הנוכחי.  
  - יישום: שילוב עם API של תחבורה ציבורית (לפי עיר/אזור) או לינק לאפליקציות ניווט ציבורי.

- **נעיצת מיקומים "בשטח" (Saved / Pinned places)**  
  - אפשרות **לשמור מיקום** (לנעוץ) תוך כדי הסתובבות – בלי להגדיר עדיין לאיזה יום או איזו פעילות הוא שייך.  
  - המיקומים השמורים יופיעו ברשימה/מפה ויוכלו **לשייך להמשך** ליום מסוים או להפוך לפעילות (למשל אטרקציה או מסעדה).  
  - מטרה: לא לאבד מקומות שמגלים בדרך; לתכנן אותם מאוחר יותר בתוך הטיול.

- **חיפוש מסעדות כשרות / טבעוניות (Happy Cow)**  
  - אינטגרציה או **קישור לחיפוש מסעדות כשרות ומסעדות טבעוניות** דרך אפליקציית **Happy Cow** (או שירות דומה).  
  - למשל: כפתור "מסעדות כשרות/טבעוניות ליד המיקום" שפותח Happy Cow עם המיקום הנוכחי או מיקום האטרקציה; או הטמעת תוצאות אם יש API זמין.

---

## 2. מודל נתונים (Data Model)

### 2.1 ישויות עיקריות (מודל מאוחד – מומלץ ל־MVP)

```
User
├── id, email, passwordHash, name?, createdAt

Trip
├── id, userId, name, startDate, endDate, destination?, createdAt, updatedAt
├── days[]        (מחושב מתאריכים – או טבלת Day אם רוצים ישות מפורשת)
├── listItems[]   (רשימות: ציוד + TODO)
├── documents[]   (צילומי מסמכים – שלב 2)

Day (מחושב מ־Trip.startDate + index, או טבלה עם tripId, date, dayIndex)
├── tripId, date, dayIndex (1, 2, 3...)
├── activities[]

Activity  ← ישות אחת עם סוג (type)
├── id, dayId (או tripId + dayIndex), type: "attraction" | "accommodation" | "transport" | "note"
├── title, description?, link?, lat?, lng?, mapLink?
├── startTime?, duration?
├── order
├── (שדות ספציפיים ללינה: checkInDate?, checkOutDate?, bookingUrl?)
├── (שדות ספציפיים לאטרקציה: openingHours?, price?)

ListItem
├── id, tripId, text, done (boolean), order
├── listType?     (optional: "packing" | "todo" או קטגוריה)

Document (צילום מסמך – שלב 2)
├── id, tripId, userId, title?, type?, fileUrl, mimeType?, createdAt, updatedAt
```

### 2.2 קשרים
- **User** → מחזיק הרבה **Trips**.
- **Trip** → הרבה **Days** (מחושבים או טבלה); **Trip** → הרבה **ListItems**.
- **Day** → הרבה **Activities**. כל פעילות שייכת ליום אחד בלבד.
- **Activity** – סוג (type) קובע תצוגה ושדות אופציונליים (לינה = פעילות עם type accommodation).

---

## 3. פירוט מסך "מבט יום" (Day View)

### 3.1 מטרה
מסך אחד שמציג את כל המידע הרלוונטי ליום מסוים בטיול.

### 3.2 אלמנטים במסך
| אלמנט | מקור נתונים | פעולות |
|--------|-------------|--------|
| כותרת | "יום 3" + תאריך (למשל 15.3.2025) | — |
| לינה היום | Activity מסוג accommodation ביום (או שתאריך היום בתוך checkIn–checkOut) | קישור לפרטים, "נווט" |
| רשימת פעילויות | Activity עם dayIndex = היום (כל הסוגים) | גרירה, עריכה, מחיקה, "נווט" |
| מפת היום / ניווט | שדות מיקום של פעילויות | לינק למפה חיצונית, "נווט" |

### 3.3 זרימה
1. משתמש בוחר טיול → רשימת ימים (או לוח).
2. לחיצה על יום → כניסה ל"מבט יום".
3. במבט יום: לינה למעלה, אחר כך רשימת פעילויות, אז אטרקציות, ולבסוף מפה (או מפה צמודה למעלה).

---

## 4. מפת מסכים (Navigation)

```
[כניסה] → Login / Register

[דף בית] → "הטיולים שלי"
    └── כפתור: "טיול חדש"
    └── כרטיס טיול → [טיול]

[טיול] → טאבים או תפריט צד:
    ├── ימים (רשימה) → [יום X]
    ├── מפה (מפת כל המיקומים)
    ├── לינה (רשימת כל מקומות הלינה)
    ├── אטרקציות (רשימה)
    ├── רשימות (קניות)
    └── מסמכים (צילומי מסמכים – הוספה, צפייה, מחיקה)

[יום X] → מבט יום (לוח זמנים + לינה + אטרקציות + מפת היום)
```

---

## 5. שפות תכנות ואסטרטגיה – המלצות (מעודכן)

### 5.1 דרישות
- **Web-first, mobile-first** – קוד אחד ל־Web ולמובייל (PWA).
- **פיתוח מהיר** ו־MVP בר־שמירה.
- **תמיכת offline** – cache וסנכרון בצד הלקוח.

---

### 5.2 Stack מומלץ (מתוך גרסה מעודכנת)

| שכבת | טכנולוגיה | הערה |
|------|------------|------|
| **Frontend** | TypeScript, React, **Next.js** | Web-first, mobile-first |
| **PWA** | Service Worker, manifest | התקנה למסך, offline מכובד |
| **Backend** | REST או Server Actions (Next.js) | פשוט וברור |
| **DB + Auth** | **PostgreSQL**, **Supabase** (Auth + DB + Storage) | פחות תחזוקת שרת |
| **ולידציה** | **Zod** | סכמה בצד לקוח (ו־API) |
| **נתונים בצד לקוח** | Cache + סנכרון | לתמיכת offline ו־queue שינויים |

**שפה:** **TypeScript** מקצה לקצה.

---

### 5.3 אלטרנטיבות (להתייחסות)

- **React + React Native (Expo)** – אם בהמשך תרצה אפליקציה native בחנות; שיתוף לוגיקה וטיפוסים.
- **Flutter** – קוד UI אחד למובייל ו־Web; פחות נפוץ ב־TS/React.
- **Vite במקום Next.js** – אם לא צריך SSR/Server Actions; Next נוח ל־API ו־PWA.

---

## 6. אסטרטגיית פיתוח מומלצת

### 6.1 בחירת מסלול
לשילוב **Web + מובייל** עם סיכון נמוך ומהירות:

1. **שלב 1 – Web + PWA**  
   - לבנות את כל ה־MVP כ־**React (או Next.js) + TypeScript**.  
   - להוסיף PWA (manifest + Service Worker) כדי לאפשר "התקנה למסך" במובייל.  
   - כך יש **אפליקציה אחת** שעובדת בדפדפן ובמובייל.

2. **שלב 2 – אפליקציה native (אם צריך)**  
   - אם תרצה אפליקציה בחנות (App Store / Play):  
     - **אופציה א** – React Native (Expo) ולשתף לוגיקה/API עם ה־Web.  
     - **אופציה ב** – עטיפה ל־PWA עם **Capacitor** או **TWA** (Trusted Web Activity) – בעצם אותו Web בתוך אפליקציה.

### 6.2 סדר פיתוח מוצע (לפי שבועות/ספרינטים)

| שלב | תוכן | תוצאה |
|-----|------|--------|
| **1** | סביבת פיתוח, פרויקט (Next + TS), Supabase Auth, רישום/התחברות | משתמש יכול להירשם ולהתחבר |
| **2** | CRUD טיולים, חישוב ימים מתאריכים | יצירה, עריכה, מחיקה, רשימת טיולים |
| **3** | פעילויות ליום (כולל סוג: אטרקציה/לינה/תחבורה/הערה), מסך "מבט יום" | לוח זמנים יומי, הוספה/עריכה/מחיקה |
| **4** | רשימות (ציוד + TODO) | רשימות עם סימון בוצע |
| **5** | מיקום וניווט – שדות lat/lng, כפתור "נווט" | לינק ל־Google Maps/Waze |
| **6** | PWA (manifest, Service Worker, responsive) + **offline** (cache, queue סנכרון) | "התקנה למסך", צפייה/עריכה offline |
| **7** | שיתוף (קישור read-only), ייצוא (PDF / טקסט) | שיתוף וייצוא בסיסי |
| **8** | צילומי מסמכים – העלאה, תצוגה, מחיקה (שלב 2) | מסך "מסמכים" בטיול |
| **9** | ליטושים, NFR (טעינה מתחת ל־2 שניות, אובדן מידע), אירוח | MVP מוכן להעלאה |

### 6.3 עקרונות
- **להתחיל ב־Web** – בדיקות מהירות, שיתוף קל.
- **לעצב Mobile-First** – CSS responsive ו־touch, כדי ש־PWA במובייל יהיה נוח.
- **API ברור** – להפריד Frontend ↔ Backend מההתחלה (REST או GraphQL), כדי שאם תוסיף אפליקציה native – תשתמש באותו API.
- **מסד נתונים פשוט** – טבלאות User, Trip, Activity, Accommodation, Attraction, ShoppingItem, Document; להוסיף אינדקסים לפי `tripId`, `userId`.

---

## 7. סיכום המלצות

| נושא | המלצה |
|------|--------|
| **שפה** | **TypeScript** מקצה לקצה |
| **Frontend** | **React + Next.js** (Web-first, mobile-first) |
| **מובייל** | **PWA** (אותה אפליקציה; התקנה למסך + offline) |
| **Backend** | **Next.js** (Server Actions / API) + **Supabase** (Auth + DB + Storage) |
| **DB** | **PostgreSQL** (דרך Supabase) |
| **ולידציה** | **Zod** |
| **מודל** | **Activity** מאוחד (סוג: אטרקציה/לינה/תחבורה/הערה), **ListItem** לרשימות |

### שיפורים עתידיים (פוסט־MVP)
- **שיתוף עם הרשאות ועריכה משותפת** ✓ מיושם – הזמנה באמצעות קישור עם בחירת תפקיד (משתתף/צופה), דף קבלת הזמנה, שליחה במייל/וואטסאפ
- **תגיות וסינונים** ✓ מיושם – תגיות לטיול (עריכה בדף עריכת טיול), סינון לפי תגית בדף בית
- **מעקב תקציב** ✓ מיושם – תקציב מתוכנן לטיול, רשימת הוצאות, סה״כ ונותר/חריגה
- **נעיצת מיקומים** ✓ מיושם – שמירת מקום (שם, כתובת) לטיול; מופיע במפה ורשימה; מחיקה
- **תזכורות (התראות לפי זמן)** ✓ מיושם – תזכורות לטיול עם תאריך ושעה, התראות דפדפן (Notification API), סימון הופעל
- **הצעות חכמות** ✓ מיושם – הצעות אטרקציות מ-OpenTripMap לפי יעד הטיול, הוספה בלחיצה
- **חיפוש תחנות מטרו/אוטובוס** ✓ מיושם – קישור תחבורה ציבורית (Google Maps Transit) בכל מיקום
- **חיפוש מסעדות כשרות/טבעוניות** ✓ מיושם – קישור Happy Cow בכל מיקום (לינה, אטרקציה, פעילות)

---

## סטטוס מימוש (Implementation status)

סטטוס השלבים לפי 6.2 (נכון למועד עדכון המסמך):

| שלב | סטטוס | תיאור קצר |
|-----|--------|------------|
| **1** | מיושם | אימות – הרשמה/התחברות באימייל+סיסמה, כניסה עם Google ו־Apple, פרופיל (עדכון שם), מסלולים מוגנים. |
| **2** | מיושם | CRUD טיולים – יצירה, עריכה, מחיקה, רשימת טיולים; ימים מחושבים מתאריכים; סינון עתיד/עבר (דף בית). |
| **3** | מיושם | פעילויות + מבט יום – פעילויות, לינה ואטרקציות (כ־ישויות נפרדות ב־DB), מסך "מבט יום" עם לוח זמנים ולינק "נווט". |
| **4** | מיושם | רשימות – רשימת קניות/ציוד עם סימון בוצע, הוספה/עריכה/מחיקה. |
| **5** | מיושם | מפות וניווט – שדות מיקום (lat/lng), מפת Leaflet במבט יום ובטיול, גאוקודינג, כפתור "נווט" (Google Maps). |
| **6** | מיושם | PWA – manifest, Service Worker (Workbox), "התקנה למסך", cache; תור offline – שינויים offline נשמרים בתור ומסתנכרנים בחזרת החיבור. |
| **7** | מיושם | שיתוף – קישור read-only (share token + SharePage); ייצוא לטקסט (.txt); הדפסה/ייצוא PDF (כפתור "הדפס / ייצוא PDF" + סטייל הדפסה). |
| **8** | מיושם | מסמכים – העלאה, תצוגה, עריכה ומחיקה של מסמכים לטיול (טבלת documents, API, רכיב TripDocuments). |
| **9** | מיושם | ליטושים – מצבי ריק (Home, Trip, DayView, מסמכים), טעינה ראשונית (skeleton ב־Home), ולידציה ב־Zod (טפסים); אירוח – README + netlify/vercel. |

### סטיות מהתכנון (Deviations)

- **Frontend:** נבנה עם **Vite + React** (ו־React Router) במקום Next.js.
- **Backend ו־DB:** **Express + SQLite** (better-sqlite3) במקום Supabase/PostgreSQL; אימות עצמאי (JWT, bcrypt, Google OAuth, Apple JWKS) במקום Supabase Auth.
- **מודל נתונים:** ב־DB קיימות טבלאות נפרדות ל־activities, accommodations, attractions (במקום ישות Activity מאוחדת עם שדה type כמתואר במסמך).
- **Docker:** קיים Dockerfile ל־Backend; אירוח מלא (כולל Frontend) לא הוגדר במסגרת זו.
- **ייצוא:** ייצוא לטקסט + כפתור "הדפס / ייצוא PDF" (סטייל הדפסה; המשתמש יכול "שמירה כ־PDF" מתוך דיאלוג ההדפסה).
- **גרירה:** סדר פעילויות ניתן לשינוי גרירה במבט יום (@dnd-kit); Backend תומך ב־order ב־PUT activities.
- **ולידציה:** Zod מיושם בפרונט (טפסי טיול, התחברות, הרשמה, פעילות).

---

בשלב הבא אפשר:  
- להגדיר את מבנה התיקיות של הפרויקט (Frontend + Backend),  
- או להתחיל בסקיצת API (endpoints) לכל ה־CRUD של הטיול, הימים והפעילויות.
